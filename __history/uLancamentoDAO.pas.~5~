unit uLancamentoDAO;

interface

uses
  uLancamento, uConexao, System.SysUtils, FireDAC.Comp.Client, FireDAC.Stan.Param,
  FireDAC.DApt, uUtils, System.Generics.Collections, Vcl.Dialogs;

type
  TLancamentoDAO = class
  public
    procedure InserirLancamento(const ALancamento: TLancamento);
  end;

implementation

procedure TLancamentoDAO.InserirLancamento(const ALancamento: TLancamento);
var
  Qry: TFDQuery;
begin
  Qry := TFDQuery.Create(nil);

  try
    try
      Qry.Connection := dmConexao.FDConnection;
      // SQL para inserir o novo lançamento
      Qry.SQL.Text := 'INSERT INTO lancamentos (categoria, tipo, descricao, valor, data, observacoes, entidade) VALUES' +
      '(:categoria, :tipo, :descricao, :valor, :data, :observacoes, :entidade)';
      // Define as propriedades do lançamento como parâmetro pro insert
      Qry.ParamByName('categoria').AsInteger := ALancamento.CategoriaID;
      Qry.ParamByName('tipo').AsString := CatToStr(ALancamento.Tipo);
      // Executa a query
      Qry.ExecSQL;

      // Recupera o ID do lançamento inserido e grava no objeto
      ALancamento.ID := Qry.Connection.ExecSQLScalar('SELECT LAST_INSERT_ID()');
    except
        on E: Exception do
        ShowMessage(E.Message);
    end;
  finally
    Qry.Free;
  end;
end;

end.
